@inherits LayoutComponentBase
@inject IDialogService DialogService
@inject NavigationManager NavigationManager
@using BeautyBeastServer.Components.Dialogs

<MudThemeProvider />
<MudPopoverProvider />
<MudDialogProvider />
<MudSnackbarProvider />

<MudLayout>
    <MudAppBar Elevation="1" Style="@($"background-color: {Colors.Teal.Darken1}")">
        <MudIconButton Icon="@Icons.Material.Filled.Menu" Color="Color.Inherit" Edge="Edge.Start" OnClick="OpenTemporaryDrawer" />
        <MudMenu Icon="@Icons.Material.Outlined.Camera" Color="Color.Inherit">
            <MudMenuItem OnClick="@ShowStatusPostDialog">Status</MudMenuItem>
            <MudMenuItem OnClick="@ShowMediaPostDialog">Media</MudMenuItem>
        </MudMenu>
        <MudText Typo="Typo.h5" Class="mt-1">BeautyBeast</MudText>
        <MudSpacer />
        <MudIconButton Icon="@Icons.Material.Filled.MoreVert" Color="Color.Inherit" Edge="Edge.End" />
    </MudAppBar>

    <MudDrawer @bind-Open="_drawerOpen" Anchor="Anchor.Start" Elevation="1" Variant="DrawerVariant.Temporary">
        <MudDrawerHeader Style="@($"background-color: {Colors.Teal.Darken1}")">
            <MudText Typo="Typo.h6">Navigation</MudText>
        </MudDrawerHeader>
        <MudNavMenu>
            <MudNavLink Href="/" Icon="@Icons.Material.Filled.Dashboard">Dashboard</MudNavLink>
            <MudNavLink Href="/myAccount" Match="NavLinkMatch.Prefix">My Account</MudNavLink>
            <MudNavLink Href="/profile/CurrentUserId" Icon="@Icons.Material.Filled.Person">My Profile</MudNavLink>
            
            <MudNavGroup Title="Settings" Expanded="true">
                <MudNavLink Href="/security" Match="NavLinkMatch.Prefix">Security</MudNavLink>
            </MudNavGroup>
            
            <MudNavGroup Title="Accounts" Expanded="true">
                <MudNavLink Href="/account/users" Match="NavLinkMatch.Prefix">Users</MudNavLink>
                <MudNavLink Href="/account/signin" Match="NavLinkMatch.Prefix">Sign In</MudNavLink>
                <MudNavLink Href="/account/signup" Match="NavLinkMatch.Prefix">Sign Up</MudNavLink>
            </MudNavGroup>
            
            <MudNavLink Href="/about" Match="NavLinkMatch.Prefix">About</MudNavLink>
            <MudTextField @bind-Value="SearchText" Placeholder="Search..." Variant="Variant.Text" Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Search" OnKeyDown="HandleSearchKeyDown" />
            <MudNavLink OnClick="_ => _drawerOpen = false">Close Drawer</MudNavLink>
        </MudNavMenu>
    </MudDrawer>

    <MudMainContent>
        @Body
    </MudMainContent>
</MudLayout>

<MudDialogProvider/>

@code {
    private bool _drawerOpen = true;
    private string SearchText { get; set; } = string.Empty;

    private void OpenTemporaryDrawer()
    {
        _drawerOpen = true;  // Open the temporary drawer when the menu icon is clicked
    }

    private void HandleSearchKeyDown(KeyboardEventArgs e)
    {
        if (e.Key == "Enter")
        {
            Console.WriteLine($"Search for: {SearchText}");
        }
    }

    private async Task ShowStatusPostDialog()
    {
        var options = new DialogOptions { CloseButton = true, MaxWidth = MaxWidth.Large, FullWidth = true };
        var dialog = await DialogService.ShowAsync<PostStatusDialog>("Create Status Post", options);
        await dialog.Result;
    }

    private async Task ShowMediaPostDialog()
    {
        var options = new DialogOptions { CloseButton = true, MaxWidth = MaxWidth.Large, FullWidth = true };
        var dialog = await DialogService.ShowAsync<PostMediaDialog>("Create Media Post", options);
        await dialog.Result;
    }
}