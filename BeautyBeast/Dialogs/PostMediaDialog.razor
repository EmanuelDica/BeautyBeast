@namespace BeautyBeastApp.Dialogs
@inject BeautyBeastApp.Services.PostService PostService

<MudDialog>
    <DialogContent>
        <MudFileUpload T="IBrowserFile" Accept=".png, .jpg" FilesChanged="UploadFiles2" MaximumFileCount="100">
            <ActivatorContent>
                <MudButton Variant="Variant.Filled"
                        Color="Color.Primary"
                        StartIcon="@Icons.Material.Filled.CloudUpload">
                    Search for Images
                </MudButton>
            </ActivatorContent>
        </MudFileUpload>
    </DialogContent>

    <DialogActions>
        <MudButton OnClick="Cancel">Cancel</MudButton>
        <MudButton Color="Color.Primary" OnClick="Submit">Ok</MudButton>
    </DialogActions>
</MudDialog>

@if (files != null)
{
    <MudList T="string">
        @foreach (var file in files)
        {
            <MudListItem Icon="@Icons.Material.Filled.AttachFile">
                @file.Name <code>@file.Size bytes</code>
            </MudListItem>
        }
    </MudList>
}

@code {

    IList<IBrowserFile> files = new List<IBrowserFile>();

    [CascadingParameter]
    private MudDialogInstance MudDialog { get; set; } = default!;

    private void Submit()
    {
        var post = new BeautyBeastApp.Services.Post
        {
            UserId = "CurrentUserId", // Replace with actual user ID
            Type = "media",
            MediaFiles = files.Select(f => f.Name).ToList()
        };

        PostService.AddPost(post);

        MudDialog.Close(DialogResult.Ok(true));
    }

    private void Cancel() => MudDialog.Cancel();

     private void UploadFiles2(IBrowserFile file)
    {
        files.Add(file);
        //TODO upload the files to the server
    }
}